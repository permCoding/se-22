# MySQL

## ЛАБРАБ-04 - 16,23.04.21  

*deadline 24.04.21 24:00*  

Тема MySQL  
Часть 1.  
Обработка данных одной таблицы средствами **mysql2**.  

[Библиотека mysql2 - запросы к одной таблице - пошаговая инструкция](../../theme-06-MySQL/introLibMySQL2.md)  

Все примеры программ, знания которых достаточно для выполнения этой лабораторки тут: [theme-06-MySQL/part2-SQL](https://github.com/permCoding/nodejs21/tree/main/theme-06-MySQL/part2-SQL).  

Вот этих зависимостей будет достаточно, чтобы выполнить все задания лабораторки:  

```js  
{
  "dependencies": {
    "csvjson": "^5.1.0",
    "mysql2": "^2.2.5"
  }
}
```

---  
---  

**Что нужно сделать по этой работе и что сдавать?**  

В этой работе будет использоваться только одна таблица.  
Нужно будет создать в базе данных таблицу **data_set**.  
Взять данные из csv-файла [data_set.csv](./data_set.csv) и загрузить их в таблицу **data_set**.  
Потом сделать несоклько разных запросов (оценить время работы запросов SELECT).  
Потом добавить индексы и сравнить производительность запросов с индексами и без.  

В вашем аккаунте на pgsha.ru должна остаться база данных с таблицей.  
В свой репозиторий загрузите программы по задачам.  
Кроме того, сделайте файл readme.md в папке с решениями, где опишите проделанные сравнения по времени и по количеству операций (с индексацией и без индексации) <-- это сделать **ОБЯЗАТЕЛЬНО**.  

---  
---  

Вот пример данных из csv-файла:  

```js
day,station,name,cnt
2010-07-15,Суксун,michael argenziano,6
2010-07-15,Кунгур,robin goland,3
2010-07-15,Суксун,peter whitehouse,3
2010-07-15,Кунгур,steven nissen,3
2010-07-15,Суксун,ronald peterson,3
2010-07-15,Кунгур,richard platt,2
2010-07-15,Кунгур,jon lapook,2
2010-07-15,Кунгур,david graham,2
2010-07-15,Кунгур,janet woodcock,2
2010-07-15,Кунгур,allison goldfine,2
```

Предположим, что этот файл хранит данные обследования клиентов/пациентов за несколько лет.  
Для анализа медицинской статистики нужна дата, город, и количество антител (столбец 4) в крови пациента. Каждый клиент/пациент обследуется неоднократно. По результатам многолетних исследований можно будет выявить разные корреляции от образа жизни и города проживания.  

---  
---  

### Задания для самостоятельного исполнения  

task_00. В своём аккаунте на pgsha.ru создайте для этой лабораторки базу данных **'soft00XX_labrab04'** (где XX - это ваш индивидуальный номер)  

> Далее все задания выполнять на **node.js** с использованием библиотеки **mysql2**.  
> Для каждого задания делать отдельную программу с соответствующим номером, например так: **task_01.js**.  
> Предварительно сами SQL-запросы вы можете отрабатывать непосредственно в **phpMyAdmin**.  

task_01. Напишите программу, которая будет создавать таблицу **data_set** в базе данных с названиями полей и типами их данных в соответствии со структурой **data_set.csv**.  

> Тут вы должны самостоятельно оценить, сколько столбцов, какие их имена и какие требуются для них типы данных.  
> Пример [07-create.js](../../theme-06-MySQL/part2-SQL/readme.md#07-createjs)  

task_02. Напишите программу, которая будет добавлять одну запись к таблице **data_set**.  

> Например, можно добавить такую запись:  
> 2021-04-17,Александровск,elon musk,202  
> Эти данные не надо брать из файла - их можно написать непосредственно в SQL-запросе.  
> Пример [08-insert.js](../../theme-06-MySQL/part2-SQL/readme.md#08-insertjs)  

task_03. Напишите программу, которая будет удалять все записи из таблицы.  
> Очистите таблицу.  
> Пример [09-truncate.js](../../theme-06-MySQL/part2-SQL/readme.md#09-truncatejs)  

task_04. Напишите программу, которая будет считывать все данные из файла **data_set.csv** и добавлять их в виде записей в таблицу **data_set** базы данных.  

> Пример [14-insmany.js](../../theme-06-MySQL/part2-SQL/readme.md#14-insmanyjs)  

task_05. Напишите программу, которая будет узнавать через SQL-запрос и выводить на экран общее количество записей в таблице **data_set**.  

> Пример [05-count.js](../../theme-06-MySQL/part2-SQL/readme.md#05-countjs)  

task_06. Напишите программу, которая будет выводить на экран все записи по клиенту 'laura abc'.  

> Оцените время выполнения запроса и количество просмотренных записей.  
> Добавьте индекс для столбца name и повторите запрос.  
> Сравните время выполнения запроса и количество просмотренных записей с индексацией и без.  
> Пример [22-params.js](../../theme-06-MySQL/part2-SQL/readme.md#22-paramsjs)  

task_07. Напишите программу, которая будет получать из отсортированного по полю **count** по убыванию списка записей только первые **20** и выводить на экран (пример см. ниже).  

> node.js будет приводить столбец с датами к типу данных Date, но так как у нас в таблице нет времени, то попытка приведения будет давать примерно такой результат: 2020-03-18T19:00:00.000Z  
> вы можете исправить вывод на экран средствами node.js или непосредственно в SQL-запросе функцией так: DATE_FORMAT(day, '%Y.%m.%d') - пример: [seldate.js](../../theme-06-MySQL/part2-SQL/readme.md#seldatejs)  

task_08. Напишите программу, которая будет выводить на экран все записи замеров для клиента с самым высоким **count**, отсортировав по дате замера по возрастанию (пример см. ниже).  

> Клиента с самым большим count в этой задаче нужно не прописывать вручную, а определять в рамках основного запроса SELECT в виде вложенного запроса SELECT.  
> Оцените время выполнения запроса task_08 без индексации по столбцу count и с индексацией.
> В итоге в таблице должны быть/остаться два индекса: для столбцов name и count.  

```js
. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 
```

**Далее приведены примеры выводов по некоторым задачам:**  

**task_07**  

```js
┌─────────┬──────────────┬─────────────────┬───────────────────┬───────┐
│ (index) │     day      │      city       │       name        │ count │
├─────────┼──────────────┼─────────────────┼───────────────────┼───────┤
│    0    │ '2020.03.19' │ 'Александровск' │  'sanjay gupta'   │ 22957 │
│    1    │ '2020.04.16' │ 'Александровск' │  'sanjay gupta'   │ 21172 │
│    2    │ '2020.04.09' │ 'Александровск' │  'sanjay gupta'   │ 18566 │
│    3    │ '2020.03.26' │ 'Александровск' │  'sanjay gupta'   │ 17739 │
│    4    │ '2020.03.05' │ 'Александровск' │  'sanjay gupta'   │ 17253 │
│    5    │ '2020.04.02' │ 'Александровск' │  'sanjay gupta'   │ 16945 │
│    6    │ '2020.04.23' │ 'Александровск' │  'sanjay gupta'   │ 16689 │
│    7    │ '2020.03.25' │ 'Александровск' │  'sanjay gupta'   │ 15925 │
│    8    │ '2020.04.13' │    'Губаха'     │ 'ezekiel emanuel' │ 8930  │
│    9    │ '2020.04.06' │    'Губаха'     │ 'ezekiel emanuel' │ 8295  │
```

**task_08**  

```js
┌─────────┬──────────────┬─────────────────┬────────────────┬───────┐
│ (index) │     day      │      city       │      name      │ count │
├─────────┼──────────────┼─────────────────┼────────────────┼───────┤
│    0    │ '2010.09.30' │    'Кунгур'     │ 'sanjay gupta' │   3   │
│    1    │ '2010.10.05' │    'Кунгур'     │ 'sanjay gupta' │   4   │
│    2    │ '2011.01.05' │    'Кунгур'     │ 'sanjay gupta' │   2   │
│    3    │ '2011.01.06' │    'Кунгур'     │ 'sanjay gupta' │   3   │
│    4    │ '2011.01.07' │    'Кунгур'     │ 'sanjay gupta' │  11   │
│    5    │ '2011.02.18' │    'Кунгур'     │ 'sanjay gupta' │   4   │
│    6    │ '2011.03.17' │    'Кунгур'     │ 'sanjay gupta' │  14   │
│    7    │ '2011.06.17' │    'Кунгур'     │ 'sanjay gupta' │   3   │
│    8    │ '2011.10.28' │    'Кунгур'     │ 'sanjay gupta' │   6   │
│    9    │ '2013.02.24' │    'Кунгур'     │ 'sanjay gupta' │   7   │
│   10    │ '2020.01.25' │ 'Александровск' │ 'sanjay gupta' │  192  │
```

---  
